<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Day - Nebraska Football</title>
    <link rel="icon" type="image/png" href="images/favicon-rhuleaid.png">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* MOBILE MENU - COMPLETE OVERRIDE WITH MAXIMUM SPECIFICITY */
        
        /* Hide mobile toggle by default, show only on mobile */
        .mobile-menu-toggle {
            display: none;
        }
        
        @media screen and (max-width: 768px) {
            /* Force show mobile toggle button - right aligned */
            .mobile-menu-toggle {
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                background: rgba(255,255,255,0.2) !important;
                border: 2px solid white !important;
                color: white !important;
                padding: 12px !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                font-size: 18px !important;
                font-weight: bold !important;
                min-width: 48px !important;
                min-height: 48px !important;
                z-index: 10001 !important;
                margin-left: auto !important;
            }
            
            /* Ensure header actions are right-aligned */
            .header-actions {
                display: flex !important;
                gap: 10px !important;
                align-items: center !important;
                margin-left: auto !important;
            }
            
            /* Hide desktop navigation on mobile */
            body .site-header .header-content .header-left .site-nav {
                display: none !important;
                position: absolute !important;
                top: 100% !important;
                right: 0 !important;
                left: auto !important;
                background: #dc2626 !important;
                padding: 20px !important;
                border-radius: 0 0 15px 15px !important;
                box-shadow: 0 8px 25px rgba(0,0,0,0.4) !important;
                z-index: 10000 !important;
                margin: 0 !important;
                width: 280px !important;
                max-width: 90vw !important;
                box-sizing: border-box !important;
                transform: translateX(100%) !important;
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }
            
            /* Show navigation when active - slide in from right */
            body .site-header .header-content .header-left .site-nav.mobile-active {
                display: block !important;
                transform: translateX(0) !important;
            }
            
            /* Force navigation list to be vertical and left-aligned */
            body .site-header .header-content .header-left .site-nav ul {
                display: block !important;
                flex-direction: column !important;
                gap: 0 !important;
                padding: 0 !important;
                margin: 0 !important;
                list-style: none !important;
                text-align: left !important;
                align-items: stretch !important;
                justify-content: flex-start !important;
            }
            
            /* Force navigation items to be full width blocks */
            body .site-header .header-content .header-left .site-nav li {
                display: block !important;
                margin: 0 0 8px 0 !important;
                width: 100% !important;
                text-align: left !important;
            }
            
            /* Force navigation links to be left-aligned blocks with slide animation */
            body .site-header .header-content .header-left .site-nav a {
                display: block !important;
                padding: 16px 20px !important;
                color: white !important;
                text-decoration: none !important;
                border-radius: 10px !important;
                text-align: left !important;
                background: rgba(0,0,0,0.1) !important;
                border: 1px solid transparent !important;
                width: 100% !important;
                box-sizing: border-box !important;
                margin: 0 !important;
                font-size: 16px !important;
                font-weight: 500 !important;
                transition: all 0.2s ease !important;
                transform: translateX(0) !important;
            }
            
            /* Hover and active states with left slide effect */
            body .site-header .header-content .header-left .site-nav a:hover {
                background: rgba(255,255,255,0.15) !important;
                border-color: rgba(255,255,255,0.2) !important;
                transform: translateX(-8px) !important;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important;
            }
            
            body .site-header .header-content .header-left .site-nav a.active {
                background: rgba(255,255,255,0.25) !important;
                border-color: rgba(255,255,255,0.3) !important;
                font-weight: 600 !important;
                box-shadow: 0 2px 12px rgba(0,0,0,0.3) !important;
            }
            
            /* Ensure header container allows positioning */
            .site-header {
                position: relative !important;
            }
            
            .header-content {
                position: relative !important;
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
            }
            
            /* Adjust header left section for mobile */
            .header-left {
                display: flex !important;
                align-items: center !important;
                flex: 1 !important;
            }
        }
        
        body {
            min-height: 100vh;
        }

        /* Remove the old header styles since we're using global styles.css */

        /* Main Content */
        .gameday-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-title {
            text-align: center;
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--accent-color);
        }

        .page-subtitle {
            text-align: center;
            font-size: 1.2em;
            color: var(--secondary-text);
            margin-bottom: 40px;
        }

        /* Game Info Section */
        .game-info {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .next-game {
            font-size: 1.5em;
            margin-bottom: 30px;
            color: var(--accent-color);
            font-weight: 600;
        }

        .teams {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 60px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 180px;
            flex-shrink: 0;
        }

        .team-logo {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .team-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .team-name {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            line-height: 1.2;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            width: 100%;
            color: var(--text-color);
            min-height: 2.4em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Responsive team name handling */
        @media (max-width: 768px) {
            .team-name {
                font-size: 1.4em;
                min-height: 2.1em;
            }
            
            .team {
                width: 150px;
            }
            
            .team-logo {
                width: 80px;
                height: 80px;
            }

            .team-logo img {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }

            .vs {
                margin-top: 40px;
                font-size: 1.8em;
            }

            .teams {
                gap: 30px;
            }
        }

        @media (max-width: 480px) {
            .team-name {
                font-size: 1.2em;
                min-height: 1.8em;
            }
            
            .teams {
                gap: 20px;
                flex-direction: column;
                align-items: center;
            }

            .vs {
                margin-top: 0;
                order: 1;
            }

            .team:first-child {
                order: 0;
            }

            .team:last-child {
                order: 2;
            }
        }

        .vs {
            font-size: 2em;
            font-weight: bold;
            color: var(--accent-color);
            align-self: flex-start;
            margin-top: 50px;
            flex-shrink: 0;
        }

        .game-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .game-detail {
            background: var(--hover-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .detail-label {
            font-size: 0.9em;
            color: var(--accent-color);
            margin-bottom: 5px;
            font-weight: 600;
        }

        .detail-value {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-color);
        }

        /* Countdown Section */
        .countdown-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .countdown-title {
            text-align: center;
            font-size: 2em;
            margin-bottom: 15px;
            color: var(--accent-color);
            font-weight: 600;
        }

        .countdown-subtitle {
            text-align: center;
            font-size: 1.2em;
            color: var(--secondary-text);
            margin-bottom: 30px;
        }

        .countdown {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .countdown-item {
            background: var(--hover-bg);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--accent-color);
        }

        .countdown-number {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--accent-color);
            display: block;
        }

        .countdown-label {
            font-size: 0.9em;
            margin-top: 5px;
            color: var(--secondary-text);
            font-weight: 500;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            text-align: center;
            transition: all 0.3s ease;
        }

        /* Clickable card styles */
        .stat-card.clickable-card {
            position: relative;
            cursor: pointer !important;
        }

        .stat-card.clickable-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: var(--accent-color);
        }

        .stat-card.clickable-card::after {
            content: "üîó";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.8em;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }

        .stat-card.clickable-card:hover::after {
            opacity: 1;
        }
        .stat-title {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: var(--accent-color);
            font-weight: 600;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .stat-description {
            font-size: 0.9em;
            color: var(--secondary-text);
        }

        /* Weather Section */
        .weather-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 40px;
        }

        .weather-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
        }

        .weather-title {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--text-color);
            margin: 0;
        }

        .weather-location {
            font-size: 0.9em;
            color: var(--secondary-text);
        }

        .current-weather {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 25px;
            margin-bottom: 30px;
            align-items: center;
        }

        .current-temp {
            font-size: 3.5em;
            font-weight: bold;
            color: var(--accent-color);
            text-align: center;
        }

        .current-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .weather-detail {
            text-align: center;
        }

        .weather-detail-label {
            font-size: 0.8em;
            color: var(--secondary-text);
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 500;
        }

        .weather-detail-value {
            font-size: 1.1em;
            color: var(--text-color);
            font-weight: 600;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }

        .forecast-grid.hourly-forecast {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .forecast-grid.game-window-forecast {
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            max-height: none;
            overflow-y: visible;
        }

        .forecast-day {
            background: rgba(220, 38, 38, 0.05);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .forecast-hour {
            background: rgba(220, 38, 38, 0.05);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            min-height: 140px;
        }

        .forecast-hour.game-window {
            background: rgba(220, 38, 38, 0.08);
            border: 2px solid rgba(220, 38, 38, 0.3);
        }

        .forecast-hour.game-time {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.2), rgba(220, 38, 38, 0.1));
            border: 3px solid var(--accent-color);
            transform: scale(1.02);
            position: relative;
            box-shadow: 0 4px 20px rgba(220, 38, 38, 0.3);
        }

        .forecast-hour.game-time::before {
            content: "üèà KICKOFF TIME!";
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-color);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            white-space: nowrap;
            z-index: 10;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
            100% { transform: translateX(-50%) scale(1); }
        }

        .forecast-day:hover, .forecast-hour:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .forecast-hour.game-time:hover {
            transform: scale(1.05) translateY(-2px);
        }

        .forecast-day.game-day, .forecast-hour.game-day {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(220, 38, 38, 0.05));
            border: 2px solid var(--accent-color);
            position: relative;
        }

        .forecast-day.game-day::before, .forecast-hour.game-day::before {
            content: "üèà GAME DAY!";
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: bold;
            white-space: nowrap;
        }

        .game-kickoff-time {
            animation: glow 3s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(220, 38, 38, 0.2); }
            to { box-shadow: 0 0 20px rgba(220, 38, 38, 0.4); }
        }

        .forecast-day-name {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .forecast-time {
            font-size: 0.8em;
            font-weight: 500;
            color: var(--secondary-text);
            margin-bottom: 8px;
        }

        .forecast-temp {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .forecast-condition {
            font-size: 0.8em;
            color: var(--secondary-text);
            margin-bottom: 5px;
        }

        .forecast-precipitation {
            font-size: 0.75em;
            color: var(--accent-color);
            font-weight: 500;
        }

        .weather-loading {
            text-align: center;
            padding: 40px;
            color: var(--secondary-text);
        }

        .weather-error {
            text-align: center;
            padding: 20px;
            background: rgba(220, 38, 38, 0.1);
            border-radius: 10px;
            color: var(--accent-color);
            margin-bottom: 20px;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--secondary-text);
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error State */
        .error {
            text-align: center;
            padding: 40px 20px;
            background: var(--card-bg);
            border-radius: 15px;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .page-title {
                font-size: 2em;
            }

            .teams {
                flex-direction: column;
                gap: 20px;
                align-items: center;
            }

            .vs {
                order: 1;
                margin-top: 0;
                align-self: center;
            }

            .countdown {
                grid-template-columns: repeat(2, 1fr);
            }

            .gameday-container {
                padding: 20px 15px;
            }

            .current-weather {
                grid-template-columns: 1fr;
                gap: 20px;
                text-align: center;
            }

            .current-details {
                grid-template-columns: repeat(2, 1fr);
            }

            .forecast-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .forecast-grid.hourly-forecast {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 10px;
            }

            .forecast-grid.game-window-forecast {
                grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
                gap: 12px;
            }

            .forecast-day.game-day::before, .forecast-hour.game-day::before {
                font-size: 0.6em;
                padding: 1px 6px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <div class="site-logo">
                        <a href="index.html">
                            <img src="./images/logos/nebraska-logo.png" alt="Nebraska Logo" class="site-nav-logo">
                            <h1 class="site-title">Nebraska Cornhuskers</h1>
                        </a>
                    </div>
                    <nav class="site-nav" id="site-nav">
                        <ul>
                            <li><a href="index.html">üè† Home</a></li>
                            <li><a href="schedule.html">üìÖ Schedule</a></li>
                            <li><a href="roster.html">üë• Roster</a></li>
                            <li><a href="news.html">üì∞ News</a></li>
                            <li><a href="rhule-aid.html">üç∫ Rhule-aid</a></li>
                            <li><a href="gameday.html" class="active">üèà Game Day</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="header-actions">
                    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                        <span class="dark-mode-icon">üåô</span>
                    </button>
                    <button class="mobile-menu-toggle" 
                            id="mobile-menu-btn"
                            onclick="handleMobileMenuToggle(this)"
                            title="Toggle Navigation Menu">‚ò∞</button>
                </div>
            </div>
        </div>
    </header>

    <script>
        // BULLETPROOF MOBILE MENU FUNCTIONALITY
        
        // Global variables to prevent conflicts
        window.mobileMenuOpen = false;
        
        function handleMobileMenuToggle(button) {
            console.log('Mobile menu toggle clicked!', window.mobileMenuOpen);
            
            try {
                // Find the button and navigation
                var btn = button || document.getElementById('mobile-menu-btn') || document.querySelector('.mobile-menu-toggle');
                var nav = document.querySelector('.site-nav');
                
                if (!btn) {
                    console.error('Mobile menu button not found!');
                    return;
                }
                
                if (!nav) {
                    console.error('Navigation not found!');
                    return;
                }
                
                console.log('Button:', btn, 'Nav:', nav);
                
                // Toggle the active state
                window.mobileMenuOpen = !window.mobileMenuOpen;
                
                if (window.mobileMenuOpen) {
                    nav.classList.add('mobile-active');
                    console.log('Menu opened - added mobile-active class');
                } else {
                    nav.classList.remove('mobile-active');
                    console.log('Menu closed - removed mobile-active class');
                }
                
                console.log('Nav classes after toggle:', nav.className);
                
            } catch (error) {
                console.error('Error in handleMobileMenuToggle:', error);
            }
        }
        
        // Fallback function for any existing toggleMobileMenu calls
        function toggleMobileMenu() {
            console.log('Legacy toggleMobileMenu called - redirecting to handleMobileMenuToggle');
            handleMobileMenuToggle();
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            if (window.mobileMenuOpen) {
                var nav = document.querySelector('.site-nav');
                var btn = document.querySelector('.mobile-menu-toggle');
                
                if (nav && btn && !nav.contains(event.target) && !btn.contains(event.target)) {
                    window.mobileMenuOpen = false;
                    nav.classList.remove('mobile-active');
                    console.log('Menu closed by outside click');
                }
            }
        });
        
        // Close menu on window resize to desktop
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768 && window.mobileMenuOpen) {
                var nav = document.querySelector('.site-nav');
                if (nav) {
                    window.mobileMenuOpen = false;
                    nav.classList.remove('mobile-active');
                    console.log('Menu closed due to window resize');
                }
            }
        });
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            var btn = document.querySelector('.mobile-menu-toggle');
            var nav = document.querySelector('.site-nav');
            
            console.log('Mobile menu initialized:', {
                button: !!btn,
                navigation: !!nav,
                windowWidth: window.innerWidth
            });
        });
    </script>

    <!-- Main Content -->
    <main class="gameday-container">
        <!-- Title/Countdown Section -->
        <div id="countdownSection" class="countdown-section">
            <h2 id="countdownTitle" class="countdown-title">üèà GAME DAY</h2>
            <p id="countdownSubtitle" class="countdown-subtitle">Get ready for Nebraska Cornhuskers football!</p>
            <div id="countdownDisplay" class="countdown" style="display: none;">
                <div class="countdown-item">
                    <span id="days" class="countdown-number">--</span>
                    <div class="countdown-label">Days</div>
                </div>
                <div class="countdown-item">
                    <span id="hours" class="countdown-number">--</span>
                    <div class="countdown-label">Hours</div>
                </div>
                <div class="countdown-item">
                    <span id="minutes" class="countdown-number">--</span>
                    <div class="countdown-label">Minutes</div>
                </div>
                <div class="countdown-item">
                    <span id="seconds" class="countdown-number">--</span>
                    <div class="countdown-label">Seconds</div>
                </div>
            </div>
        </div>

        <!-- Game Info Section -->
        <div id="gameInfo" class="loading">
            <div class="spinner"></div>
            <p>Loading next game information...</p>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats">
            <div class="stat-card" id="stadiumCard">
                <div class="stat-title" id="stadiumTitle">üèüÔ∏è Memorial Stadium</div>
                <div class="stat-value" id="stadiumCapacity">85,458</div>
                <div class="stat-description" id="stadiumDescription">Seating Capacity</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">üéØ This Season</div>
                <div class="stat-value" id="seasonRecord">--</div>
                <div class="stat-description">Win-Loss Record</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">üèÜ Conference</div>
                <div class="stat-value">Big Ten</div>
                <div class="stat-description">Championship Goals</div>
            </div>
        </div>
        <!-- Weather Section -->
        <div class="weather-section">
            <div class="weather-header">
                <span style="font-size: 1.5em;">üå§Ô∏è</span>
                <div>
                    <h3 class="weather-title">Game Day Weather</h3>
                    <p class="weather-location">Lincoln, NE</p>
                </div>
            </div>
            
            <div id="weatherContent" class="weather-loading">
                <div class="spinner"></div>
                <p>Loading weather information...</p>
            </div>
        </div>
    </main>

    <script>
        let countdownInterval;
        let nextGame = null;

        // Stadium information database
        const stadiumDatabase = {
            'Memorial Stadium, Lincoln, NE': {
                name: 'Memorial Stadium',
                location: 'Lincoln, NE',
                capacity: '85,458',
                surface: 'Artificial Turf',
                opened: '1923',
                nickname: 'The Sea of Red',
                gamedayLink: 'https://huskers.com/football-game-day-information'
            },
            'Arrowhead Stadium, Kansas City, MO': {
                name: 'Arrowhead Stadium',
                location: 'Kansas City, MO',
                capacity: '76,416',
                surface: 'Grass',
                opened: '1972',
                nickname: 'The Loudest Stadium',
                gamedayLink: 'https://www.gehafieldatarrowhead.com/plan-your-visit/know-before-you-go/'
            },
            'SECU Stadium, College Park, MD': {
                name: 'SECU Stadium',
                location: 'College Park, MD',
                capacity: '51,802',
                surface: 'Artificial Turf',
                opened: '1950',
                nickname: 'Maryland Stadium',
                gamedayLink: 'https://umterps.com/sports/2018/6/18/football-game-day-information.aspx'
            },
            'Huntington Bank Stadium, Minneapolis, MN': {
                name: 'Huntington Bank Stadium',
                location: 'Minneapolis, MN',
                capacity: '50,805',
                surface: 'Artificial Turf',
                opened: '2009',
                nickname: 'The Bank',
                gamedayLink: 'https://gophersports.com/sports/2021/6/29/gameday-huntington-bank-stadium'
            },
            'Rose Bowl Stadium, Pasadena, CA': {
                name: 'Rose Bowl Stadium',
                location: 'Pasadena, CA',
                capacity: '88,565',
                surface: 'Grass',
                opened: '1922',
                nickname: 'The Granddaddy of Them All',
                gamedayLink: 'https://uclabruins.com/facilities/the-rose-bowl/1'
            },
            'Beaver Stadium, University Park, PA': {
                name: 'Beaver Stadium',
                location: 'University Park, PA',
                capacity: '106,572',
                surface: 'Grass',
                opened: '1960',
                nickname: 'Happy Valley',
                gamedayLink: 'https://gopsusports.com/west-shore-home-field-at-beaver-stadium'
            }
        };

        function getStadiumInfo(location) {
            // Try exact match first
            if (stadiumDatabase[location]) {
                return stadiumDatabase[location];
            }
            
            // Try partial matches
            for (const [stadium, info] of Object.entries(stadiumDatabase)) {
                if (location.includes(info.name) || location.includes(info.location)) {
                    return info;
                }
            }
            
            // Default fallback
            return {
                name: 'Stadium',
                location: location || 'TBD',
                capacity: 'TBD',
                surface: 'TBD',
                opened: 'TBD',
                nickname: 'Game Venue',
                gamedayLink: null
            };
        }
        // Load game day information
        async function loadGameDay() {
            try {
                console.log('Loading game day information...');
                
                // Fetch schedule data
                const response = await fetch('/api/schedule');
                const data = await response.json();
                
                if (!data.success || !data.data || data.data.length === 0) {
                    throw new Error('No schedule data available');
                }

                console.log('Schedule data loaded:', data.data.length, 'games');

                // Find the next upcoming game
                const now = new Date();
                const upcomingGames = data.data.filter(game => {
                    const gameDate = new Date(game.date);
                    return gameDate > now;
                }).sort((a, b) => new Date(a.date) - new Date(b.date));

                if (upcomingGames.length === 0) {
                    displayNoUpcomingGames();
                    return;
                }

                nextGame = upcomingGames[0];
                console.log('Next game found:', nextGame);

                displayGameInfo(nextGame);
                
                // Update stadium information
                updateStadiumCard(nextGame);
                
                // Create proper game datetime for countdown (assume times are in Central Time)
                let gameDateTime;
                if (nextGame.time === 'TBD' || nextGame.time === 'TBA' || !nextGame.time) {
                    // For TBD games, use noon on the game date in Central Time
                    const dateObj = new Date(nextGame.date);
                    dateObj.setHours(12, 0, 0, 0);
                    gameDateTime = dateObj;
                } else {
                    // Parse the date and time - assume source is in Central Time
                    const timeMatch = nextGame.time.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);
                    if (timeMatch) {
                        let hours = parseInt(timeMatch[1]);
                        const minutes = parseInt(timeMatch[2]);
                        const ampm = timeMatch[3].toUpperCase();
                        
                        if (ampm === 'PM' && hours !== 12) hours += 12;
                        if (ampm === 'AM' && hours === 12) hours = 0;
                        
                        // Create a proper date object
                        const dateObj = new Date(nextGame.date);
                        dateObj.setHours(hours, minutes, 0, 0);
                        gameDateTime = dateObj;
                    } else {
                        // Fallback to simple parsing
                        gameDateTime = new Date(nextGame.date + ' ' + nextGame.time);
                    }
                }
                
                console.log('Game date/time for countdown:', gameDateTime);
                console.log('Game date/time in CDT:', gameDateTime.toLocaleString('en-US', { timeZone: 'America/Chicago' }));
                
                startCountdown(gameDateTime);

                // Load weather information for the game location
                loadWeather(nextGame.location);
            } catch (error) {
                console.error('Error loading game day:', error);
                displayError('Failed to load game information. Please try again later.');
            }
        }

        function formatGameTimeFromCT(timeString) {
            // Handle TBD, TBA or missing time
            if (!timeString || timeString.toLowerCase() === 'tba' || timeString.toLowerCase() === 'tbd' || timeString.trim() === '') {
                return 'TBD';
            }
            
            try {
                // For now, assume our times are already in Central Time and just add the timezone suffix
                let displayTime = timeString.trim();
                
                // Add CT suffix if not already present
                if (!displayTime.match(/(CT|CDT|CST|ET|EDT|EST|MT|MDT|MST|PT|PDT|PST)$/i)) {
                    displayTime += ' CT';
                }
                
                return displayTime;
            } catch (error) {
                console.error('Error formatting time:', timeString, error);
                return 'TBD';
            }
        }

        function displayGameInfo(game) {
            const gameInfoDiv = document.getElementById('gameInfo');
            
            // Format date
            const gameDate = new Date(game.date);
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                timeZone: 'America/Chicago'
            };

            const formattedDate = gameDate.toLocaleDateString('en-US', dateOptions);
            
            // Format time using the same logic as schedule page
            const formattedTime = formatGameTimeFromCT(game.time);

            // Get opponent logo using the same service as schedule page
            const opponentLogoUrl = `/api/logo?team=${encodeURIComponent(game.opponent)}`;

            gameInfoDiv.innerHTML = `
                <div class="game-info">
                    <div class="next-game">Next Game</div>
                    
                    <div class="teams">
                        <div class="team">
                            <div class="team-logo">
                                <img src="./images/logos/nebraska-logo.png" 
                                     alt="Nebraska">
                            </div>
                            <div class="team-name">Nebraska</div>
                        </div>
                        
                        <div class="vs">VS</div>
                        
                        <div class="team">
                            <div class="team-logo">
                                <img src="${opponentLogoUrl}" 
                                     alt="${game.opponent}"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div style="background: #666; color: white; width: 100px; height: 100px; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 1.2em; font-weight: bold;">${game.opponent.charAt(0)}</div>
                            </div>
                            <div class="team-name">${game.opponent}</div>
                        </div>
                    </div>

                    <div class="game-details">
                        <div class="game-detail">
                            <div class="detail-label">üìÖ Date</div>
                            <div class="detail-value">${formattedDate}</div>
                        </div>
                        <div class="game-detail">
                            <div class="detail-label">‚è∞ Time</div>
                            <div class="detail-value">${formattedTime}</div>
                        </div>
                        <div class="game-detail">
                            <div class="detail-label">üèüÔ∏è Location</div>
                            <div class="detail-value">${game.location || 'TBD'}</div>
                        </div>
                        <div class="game-detail">
                            <div class="detail-label">${game.isHome ? 'üè†' : '‚úàÔ∏è'} Game Type</div>
                            <div class="detail-value">${game.isHome ? 'Home' : 'Away'}</div>
                        </div>
                    </div>
                </div>
            `;

            // Update stadium card information
            updateStadiumCard(game);

            // Show countdown section
            document.getElementById('countdownSection').style.display = 'block';
        }

        function updateStadiumCard(game) {
            const stadiumInfo = getStadiumInfo(game.location);
            
            const stadiumCard = document.getElementById('stadiumCard');
            const stadiumTitle = document.getElementById('stadiumTitle');
            const stadiumCapacity = document.getElementById('stadiumCapacity');
            const stadiumDescription = document.getElementById('stadiumDescription');
            
            if (stadiumTitle) {
                stadiumTitle.textContent = `üèüÔ∏è ${stadiumInfo.name}`;
            }
            
            if (stadiumCapacity) {
                stadiumCapacity.textContent = stadiumInfo.capacity;
            }
            
            if (stadiumDescription) {
                stadiumDescription.textContent = `${stadiumInfo.location} ‚Ä¢ Capacity`;
            }
            
            // Make card clickable if we have a gameday link
            if (stadiumCard && stadiumInfo.gamedayLink) {
                stadiumCard.style.cursor = 'pointer';
                stadiumCard.title = 'Click for gameday information';
                
                // Remove any existing click listeners
                stadiumCard.replaceWith(stadiumCard.cloneNode(true));
                const newStadiumCard = document.getElementById('stadiumCard');
                
                newStadiumCard.addEventListener('click', function() {
                    window.open(stadiumInfo.gamedayLink, '_blank', 'noopener,noreferrer');
                });
                
                // Add visual indicator that it's clickable
                newStadiumCard.classList.add('clickable-card');
            } else if (stadiumCard) {
                stadiumCard.style.cursor = 'default';
                stadiumCard.title = '';
                stadiumCard.classList.remove('clickable-card');
            }
            
            console.log('Updated stadium card:', stadiumInfo);
        }
        function displayNoUpcomingGames() {
            const gameInfoDiv = document.getElementById('gameInfo');
            gameInfoDiv.innerHTML = `
                <div class="game-info">
                    <div class="next-game">üèà Season Complete</div>
                    <p style="font-size: 1.2em; margin-top: 20px;">
                        No upcoming games scheduled. Check back for next season!
                    </p>
                    <p style="margin-top: 15px; opacity: 0.8;">
                        Go Big Red! üåΩ
                    </p>
                </div>
            `;
        }

        function displayError(message) {
            const gameInfoDiv = document.getElementById('gameInfo');
            gameInfoDiv.innerHTML = `
                <div class="error">
                    <h3>‚ùå Error</h3>
                    <p>${message}</p>
                    <button onclick="loadGameDay()" style="margin-top: 15px; padding: 10px 20px; background: #d00000; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Try Again
                    </button>
                </div>
            `;
        }

        function startCountdown(gameDateTime) {
            const targetDate = new Date(gameDateTime);
            
            function updateCountdown() {
                const now = new Date();
                const difference = targetDate - now;

                if (difference <= 0) {
                    // Game has started or passed - show game day
                    document.getElementById('countdownTitle').innerHTML = 'üèà GAME DAY';
                    document.getElementById('countdownSubtitle').innerHTML = 'Go Big Red! The game is here!';
                    document.getElementById('countdownDisplay').style.display = 'none';
                    
                    if (countdownInterval) {
                        clearInterval(countdownInterval);
                    }
                    return;
                }

                const days = Math.floor(difference / (1000 * 60 * 60 * 24));
                const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((difference % (1000 * 60)) / 1000);

                // Show countdown title and display
                document.getElementById('countdownTitle').innerHTML = '‚è∞ Countdown to Kickoff';
                document.getElementById('countdownSubtitle').innerHTML = 'Nebraska Cornhuskers Football';
                document.getElementById('countdownDisplay').style.display = 'grid';
                
                // Update the countdown numbers
                document.getElementById('days').textContent = days.toString().padStart(2, '0');
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            }

            // Update immediately and then every second
            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        // Update season record (placeholder)
        function updateSeasonRecord() {
            // This could be enhanced to fetch real record data
            document.getElementById('seasonRecord').textContent = '0-0';
        }

        // Mobile menu toggle function
        function toggleMobileMenu() {
            const nav = document.getElementById('site-nav');
            nav.classList.toggle('active');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Game Day page loaded');
            loadGameDay();
            updateSeasonRecord();
        });

        // Cleanup interval when page unloads
        window.addEventListener('beforeunload', function() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
        });

        // Dark Mode Functions - Safari/iOS Compatible
        function toggleDarkMode() {
            try {
                var html = document.documentElement;
                var currentTheme = html.getAttribute('data-theme');
                var newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                
                // Safe localStorage handling for Safari
                try {
                    localStorage.setItem('theme', newTheme);
                } catch (e) {
                    console.warn('localStorage not available:', e);
                }
                
                // Update the icon
                var icon = document.querySelector('.dark-mode-icon');
                if (icon) {
                    icon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                }
            } catch (error) {
                console.error('Dark mode toggle error:', error);
            }
        }

        // Initialize dark mode on page load
        function initDarkMode() {
            try {
                var savedTheme = null;
                var prefersDark = false;
                
                // Safe localStorage access
                try {
                    savedTheme = localStorage.getItem('theme');
                } catch (e) {
                    console.warn('localStorage not available:', e);
                }
                
                // Safe media query check
                try {
                    if (window.matchMedia) {
                        prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    }
                } catch (e) {
                    console.warn('matchMedia not available:', e);
                }
                
                var theme = savedTheme || (prefersDark ? 'dark' : 'light');
                
                document.documentElement.setAttribute('data-theme', theme);
                
                // Update the icon
                var icon = document.querySelector('.dark-mode-icon');
                if (icon) {
                    icon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                }
            } catch (error) {
                console.error('Dark mode init error:', error);
                // Fallback to light mode
                document.documentElement.setAttribute('data-theme', 'light');
            }
        }

        // Weather Functions
        async function loadWeather(gameLocation = null) {
            try {
                console.log('Loading weather information for location:', gameLocation || 'Lincoln, NE (default)');
                
                // Determine forecast type based on proximity to game
                const shouldUseHourly = isWithin48Hours();
                
                // Build the API URL with location, hourly, and game time parameters
                let weatherUrl = '/api/weather';
                const params = [];
                if (gameLocation) {
                    params.push(`location=${encodeURIComponent(gameLocation)}`);
                }
                if (shouldUseHourly) {
                    params.push('hourly=true');
                }
                // Pass game time to API for high-accuracy weather selection
                if (nextGame && nextGame.date && nextGame.time && nextGame.time !== 'TBD') {
                    const gameDateTime = getGameDateTime();
                    if (gameDateTime) {
                        params.push(`gameTime=${encodeURIComponent(gameDateTime.toISOString())}`);
                    }
                }
                if (params.length > 0) {
                    weatherUrl += '?' + params.join('&');
                }
                
                let forecastType = shouldUseHourly ? 'game-window' : 'daily';
                
                console.log(`Loading ${forecastType} weather forecast from:`, weatherUrl);
                
                const response = await fetch(weatherUrl);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Weather data not available');
                }

                displayWeather(data, gameLocation, shouldUseHourly);

            } catch (error) {
                console.error('Error loading weather:', error);
                displayWeatherError();
            }
        }

        function isWithin48Hours() {
            if (!nextGame) {
                return false;
            }
            
            try {
                // Create proper game datetime for comparison (assume times are in Central Time)
                let gameDateTime;
                if (nextGame.time === 'TBD' || nextGame.time === 'TBA' || !nextGame.time) {
                    // For TBD games, use noon on the game date in Central Time
                    const dateObj = new Date(nextGame.date);
                    dateObj.setHours(12, 0, 0, 0);
                    gameDateTime = dateObj;
                } else {
                    // Parse the date and time - assume source is in Central Time
                    const timeMatch = nextGame.time.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);
                    if (timeMatch) {
                        let hours = parseInt(timeMatch[1]);
                        const minutes = parseInt(timeMatch[2]);
                        const ampm = timeMatch[3].toUpperCase();
                        
                        if (ampm === 'PM' && hours !== 12) hours += 12;
                        if (ampm === 'AM' && hours === 12) hours = 0;
                        
                        // Create a proper date object
                        const dateObj = new Date(nextGame.date);
                        dateObj.setHours(hours, minutes, 0, 0);
                        gameDateTime = dateObj;
                    } else {
                        // Fallback: assume the time is in local time
                        gameDateTime = new Date(nextGame.date + ' ' + nextGame.time);
                    }
                }
                
                const now = new Date();
                const timeDifference = gameDateTime - now;
                const hoursUntilGame = timeDifference / (1000 * 60 * 60);
                
                console.log(`Time until game: ${hoursUntilGame.toFixed(1)} hours`);
                
                return hoursUntilGame <= 48 && hoursUntilGame > 0;
            } catch (error) {
                console.error('Error calculating time until game:', error);
                return false;
            }
        }

        function getGameDateTime() {
            if (!nextGame) {
                return null;
            }
            
            try {
                // Create proper game datetime in Central Time for weather comparison
                let gameDateTime;
                if (nextGame.time === 'TBD' || nextGame.time === 'TBA' || !nextGame.time) {
                    // For TBD games, use noon on the game date in Central Time
                    const dateObj = new Date(nextGame.date);
                    dateObj.setHours(12, 0, 0, 0);
                    gameDateTime = dateObj;
                } else {
                    // Parse the date and time - assume source is in Central Time
                    const timeMatch = nextGame.time.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);
                    if (timeMatch) {
                        let hours = parseInt(timeMatch[1]);
                        const minutes = parseInt(timeMatch[2]);
                        const ampm = timeMatch[3].toUpperCase();
                        
                        if (ampm === 'PM' && hours !== 12) hours += 12;
                        if (ampm === 'AM' && hours === 12) hours = 0;
                        
                        // Create a proper date object
                        const dateObj = new Date(nextGame.date);
                        dateObj.setHours(hours, minutes, 0, 0);
                        gameDateTime = dateObj;
                    } else {
                        // Fallback: assume the time is already in local time
                        gameDateTime = new Date(nextGame.date + ' ' + nextGame.time);
                    }
                }
                
                return gameDateTime;
            } catch (error) {
                console.error('Error creating game datetime:', error);
                return null;
            }
        }
        function displayWeather(weatherData, gameLocation = null, isHourly = false) {
            const weatherContent = document.getElementById('weatherContent');
            
            // Update the weather header to show the actual location
            const weatherLocationElement = document.querySelector('.weather-location');
            if (weatherLocationElement && gameLocation) {
                // Extract city and state from location for display
                const locationMatch = gameLocation.match(/([^,]+),\s*([^,]+)$/);
                if (locationMatch) {
                    const [, city, state] = locationMatch;
                    weatherLocationElement.textContent = `${city.trim()}, ${state.trim()}`;
                } else {
                    weatherLocationElement.textContent = weatherData.location || gameLocation;
                }
            } else if (weatherLocationElement) {
                weatherLocationElement.textContent = weatherData.location || 'Lincoln, NE';
            }
            
            const current = weatherData.current;
            
            const currentHTML = `
                <div class="current-weather">
                    <div class="current-temp">${current.temperature}¬∞${current.temperatureUnit}</div>
                    <div class="current-details">
                        <div class="weather-detail">
                            <div class="weather-detail-label">Conditions</div>
                            <div class="weather-detail-value">${current.conditions}</div>
                        </div>
                        <div class="weather-detail">
                            <div class="weather-detail-label">Humidity</div>
                            <div class="weather-detail-value">${current.humidity}%</div>
                        </div>
                        <div class="weather-detail">
                            <div class="weather-detail-label">Wind</div>
                            <div class="weather-detail-value">${current.windDirection} ${current.windSpeed} mph</div>
                        </div>
                        <div class="weather-detail">
                            <div class="weather-detail-label">Last Updated</div>
                            <div class="weather-detail-value">${formatTime(current.lastUpdated)}</div>
                        </div>
                    </div>
                </div>
            `;

            let forecastHTML;
            let forecast = weatherData.forecast;
            
            if (isHourly) {
                // When we're within 48 hours, show game window forecast (4 hours before/after kickoff)
                const gameDateTime = getGameDateTime();
                if (gameDateTime) {
                    const gameWindowStart = new Date(gameDateTime.getTime() - 4 * 60 * 60 * 1000); // 4 hours before
                    const gameWindowEnd = new Date(gameDateTime.getTime() + 4 * 60 * 60 * 1000);   // 4 hours after
                    
                    // Filter forecast to game window and mark relevant periods
                    forecast = weatherData.forecast.filter(period => {
                        const periodTime = new Date(period.datetime);
                        return periodTime >= gameWindowStart && periodTime <= gameWindowEnd;
                    });
                    
                    // Find the single closest period to kickoff time
                    let closestPeriodIndex = -1;
                    let smallestTimeDiff = Infinity;
                    
                    forecast.forEach((period, index) => {
                        const periodTime = new Date(period.datetime);
                        const timeDiff = Math.abs(periodTime - gameDateTime);
                        if (timeDiff < smallestTimeDiff) {
                            smallestTimeDiff = timeDiff;
                            closestPeriodIndex = index;
                        }
                    });
                    
                    // Mark only the closest period as game time
                    forecast = forecast.map((period, index) => ({
                        ...period,
                        isGameDay: index === closestPeriodIndex,
                        isGameWindow: true
                    }));
                    
                    // Determine time until game for display
                    const now = new Date();
                    const hoursUntilGame = (gameDateTime - now) / (1000 * 60 * 60);
                    const timeStatus = hoursUntilGame > 0 ? 
                        `(${Math.ceil(hoursUntilGame)} hours from now)` : 
                        hoursUntilGame > -4 ? 
                        '(Game in progress or recently finished)' : 
                        '(Game completed)';
                    
                    forecastHTML = `
                        <h4 style="margin: 20px 0 15px 0; color: var(--text-color); font-size: 1.2em;">
                            üèà Game Window Forecast (4 Hours Before/After Kickoff)
                        </h4>
                        <div class="game-kickoff-time" style="text-align: center; margin: 15px 0; padding: 10px; background: rgba(220, 38, 38, 0.1); border-radius: 8px; border: 1px solid var(--accent-color);">
                            <strong>‚è∞ Kickoff: ${gameDateTime.toLocaleString('en-US', { 
                                weekday: 'long', 
                                month: 'short', 
                                day: 'numeric',
                                hour: 'numeric',
                                minute: '2-digit',
                                timeZone: 'America/Chicago',
                                timeZoneName: 'short'
                            })}</strong>
                            <div style="font-size: 0.9em; color: var(--secondary-text); margin-top: 5px;">${timeStatus}</div>
                        </div>
                        <div class="forecast-grid game-window-forecast">
                            ${forecast.map(hour => `
                                <div class="forecast-hour ${hour.isGameDay ? 'game-time' : ''} ${hour.isGameWindow ? 'game-window' : ''}">
                                    <div class="forecast-day-name">${hour.name}</div>
                                    <div class="forecast-time">${hour.time}</div>
                                    <div class="forecast-temp">${hour.temperature}¬∞${hour.temperatureUnit}</div>
                                    <div class="forecast-condition">${hour.shortForecast}</div>
                                    ${hour.precipitationProbability > 0 ? 
                                        `<div class="forecast-precipitation">${hour.precipitationProbability}% chance of rain</div>` : 
                                        '<div class="forecast-precipitation">No precipitation</div>'
                                    }
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    // If no periods found in the window, show a message
                    if (forecast.length === 0) {
                        forecastHTML += `
                            <div style="text-align: center; padding: 20px; color: var(--secondary-text); font-style: italic;">
                                Hourly forecast data not available for the game window. 
                                The forecast may extend beyond the available hourly data range.
                            </div>
                        `;
                    }
                } else {
                    // Fallback if game time couldn't be determined
                    forecastHTML = `
                        <h4 style="margin: 20px 0 15px 0; color: var(--text-color); font-size: 1.2em;">‚è∞ Hourly Forecast</h4>
                        <div class="forecast-grid hourly-forecast">
                            ${forecast.slice(0, 16).map(hour => `
                                <div class="forecast-hour ${hour.isGameDay ? 'game-day' : ''}">
                                    <div class="forecast-day-name">${hour.name}</div>
                                    <div class="forecast-time">${hour.time}</div>
                                    <div class="forecast-temp">${hour.temperature}¬∞${hour.temperatureUnit}</div>
                                    <div class="forecast-condition">${hour.shortForecast}</div>
                                    ${hour.precipitationProbability > 0 ? 
                                        `<div class="forecast-precipitation">${hour.precipitationProbability}% chance of rain</div>` : 
                                        '<div class="forecast-precipitation">No precipitation</div>'
                                    }
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            } else {
                // Daily mode: show 7 day forecast
                forecast = forecast.slice(0, 7); // Show 7 days for daily
                forecastHTML = `
                    <h4 style="margin: 20px 0 15px 0; color: var(--text-color); font-size: 1.2em;">üìÖ 7-Day Forecast</h4>
                    <div class="forecast-grid">
                        ${forecast.map(day => `
                            <div class="forecast-day ${day.isGameDay ? 'game-day' : ''}">
                                <div class="forecast-day-name">${day.name}</div>
                                <div class="forecast-temp">${day.temperature}¬∞${day.temperatureUnit}</div>
                                <div class="forecast-condition">${day.shortForecast}</div>
                                ${day.precipitationProbability > 0 ? 
                                    `<div class="forecast-precipitation">${day.precipitationProbability}% chance of rain</div>` : 
                                    '<div class="forecast-precipitation">No precipitation</div>'
                                }
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            weatherContent.innerHTML = currentHTML + forecastHTML;
        }

        function displayWeatherError() {
            const weatherContent = document.getElementById('weatherContent');
            weatherContent.innerHTML = `
                <div class="weather-error">
                    <p>Unable to load weather data. Please try again later.</p>
                    <button onclick="loadWeather(nextGame ? nextGame.location : null)" style="margin-top: 10px; padding: 8px 16px; background: var(--accent-color); color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Retry
                    </button>
                </div>
            `;
        }

        function formatTime(timestamp) {
            try {
                const date = new Date(timestamp);
                return date.toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit',
                    timeZone: 'America/Chicago'
                });
            } catch (error) {
                return 'Unknown';
            }
        }

        // Initialize dark mode when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Game Day page loaded');
            initDarkMode();
            loadGameDay();
            updateSeasonRecord();
        });
    </script>
</body>
</html>
